"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.webUrl = exports.webFragments = exports.webQueryParameters = exports.webSegment = exports.webAuthority = void 0;
const array_1 = require("../../arbitrary/array");
const constantFrom_1 = require("../../arbitrary/constantFrom");
const constant_1 = require("../../arbitrary/constant");
const SpecificCharacterRange_1 = require("./helpers/SpecificCharacterRange");
const HostArbitrary_1 = require("./HostArbitrary");
const nat_1 = require("../../arbitrary/nat");
const ipV4_1 = require("../../arbitrary/ipV4");
const ipV4Extended_1 = require("../../arbitrary/ipV4Extended");
const ipV6_1 = require("../../arbitrary/ipV6");
const oneof_1 = require("../../arbitrary/oneof");
const option_1 = require("../../arbitrary/option");
const stringOf_1 = require("../../arbitrary/stringOf");
const tuple_1 = require("../../arbitrary/tuple");
function webAuthority(constraints) {
    const c = constraints || {};
    const hostnameArbs = [HostArbitrary_1.domain()]
        .concat(c.withIPv4 === true ? [ipV4_1.ipV4()] : [])
        .concat(c.withIPv6 === true ? [ipV6_1.ipV6().map((ip) => `[${ip}]`)] : [])
        .concat(c.withIPv4Extended === true ? [ipV4Extended_1.ipV4Extended()] : []);
    return tuple_1.tuple(c.withUserInfo === true ? option_1.option(HostArbitrary_1.hostUserInfo()) : constant_1.constant(null), oneof_1.oneof(...hostnameArbs), c.withPort === true ? option_1.option(nat_1.nat(65535)) : constant_1.constant(null)).map(([u, h, p]) => (u === null ? '' : `${u}@`) + h + (p === null ? '' : `:${p}`));
}
exports.webAuthority = webAuthority;
function webSegment() {
    const others = ['-', '.', '_', '~', '!', '$', '&', "'", '(', ')', '*', '+', ',', ';', '=', ':', '@'];
    return stringOf_1.stringOf(SpecificCharacterRange_1.buildAlphaNumericPercentArb(others));
}
exports.webSegment = webSegment;
function uriQueryOrFragment() {
    const others = ['-', '.', '_', '~', '!', '$', '&', "'", '(', ')', '*', '+', ',', ';', '=', ':', '@', '/', '?'];
    return stringOf_1.stringOf(SpecificCharacterRange_1.buildAlphaNumericPercentArb(others));
}
function webQueryParameters() {
    return uriQueryOrFragment();
}
exports.webQueryParameters = webQueryParameters;
function webFragments() {
    return uriQueryOrFragment();
}
exports.webFragments = webFragments;
function webUrl(constraints) {
    const c = constraints || {};
    const validSchemes = c.validSchemes || ['http', 'https'];
    const schemeArb = constantFrom_1.constantFrom(...validSchemes);
    const authorityArb = webAuthority(c.authoritySettings);
    const pathArb = array_1.array(webSegment()).map((p) => p.map((v) => `/${v}`).join(''));
    return tuple_1.tuple(schemeArb, authorityArb, pathArb, c.withQueryParameters === true ? option_1.option(webQueryParameters()) : constant_1.constant(null), c.withFragments === true ? option_1.option(webFragments()) : constant_1.constant(null)).map(([s, a, p, q, f]) => `${s}://${a}${p}${q === null ? '' : `?${q}`}${f === null ? '' : `#${f}`}`);
}
exports.webUrl = webUrl;
