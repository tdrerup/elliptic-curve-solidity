var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var o=null;"undefined"!=typeof WebSocket?o=WebSocket:"undefined"!=typeof MozWebSocket?o=MozWebSocket:void 0!==e?o=e.WebSocket||e.MozWebSocket:"undefined"!=typeof window?o=window.WebSocket||window.MozWebSocket:"undefined"!=typeof self&&(o=self.WebSocket||self.MozWebSocket);var n,t=o,r=(function(o){var n,t;n=e,t=function(){var e=function(){},o="undefined",n=typeof window!==o&&typeof window.navigator!==o&&/Trident\/|MSIE /.test(window.navigator.userAgent),t=["trace","debug","info","warn","error"];function r(e,o){var n=e[o];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(o){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function i(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function l(t){return"debug"===t&&(t="log"),typeof console!==o&&("trace"===t&&n?i:void 0!==console[t]?r(console,t):void 0!==console.log?r(console,"log"):e)}function c(o,n){for(var r=0;r<t.length;r++){var i=t[r];this[i]=r<o?e:this.methodFactory(i,o,n)}this.log=this.debug}function s(e,n,t){return function(){typeof console!==o&&(c.call(this,n,t),this[e].apply(this,arguments))}}function u(e,o,n){return l(e)||s.apply(this,arguments)}function a(e,n,r){var i,l=this,s="loglevel";function a(){var e;if(typeof window!==o&&s){try{e=window.localStorage[s]}catch(e){}if(typeof e===o)try{var n=window.document.cookie,t=n.indexOf(encodeURIComponent(s)+"=");-1!==t&&(e=/^([^;]+)/.exec(n.slice(t))[1])}catch(e){}return void 0===l.levels[e]&&(e=void 0),e}}"string"==typeof e?s+=":"+e:"symbol"==typeof e&&(s=void 0),l.name=e,l.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},l.methodFactory=r||u,l.getLevel=function(){return i},l.setLevel=function(n,r){if("string"==typeof n&&void 0!==l.levels[n.toUpperCase()]&&(n=l.levels[n.toUpperCase()]),!("number"==typeof n&&n>=0&&n<=l.levels.SILENT))throw"log.setLevel() called with invalid level: "+n;if(i=n,!1!==r&&function(e){var n=(t[e]||"silent").toUpperCase();if(typeof window!==o&&s){try{return void(window.localStorage[s]=n)}catch(e){}try{window.document.cookie=encodeURIComponent(s)+"="+n+";"}catch(e){}}}(n),c.call(l,n,e),typeof console===o&&n<l.levels.SILENT)return"No console available for logging"},l.setDefaultLevel=function(e){a()||l.setLevel(e,!1)},l.enableAll=function(e){l.setLevel(l.levels.TRACE,e)},l.disableAll=function(e){l.setLevel(l.levels.SILENT,e)};var f=a();null==f&&(f=null==n?"WARN":n),l.setLevel(f,!1)}var f=new a,d={};f.getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var o=d[e];return o||(o=d[e]=new a(e,f.getLevel(),f.methodFactory)),o};var p=typeof window!==o?window.log:void 0;return f.noConflict=function(){return typeof window!==o&&window.log===f&&(window.log=p),f},f.getLoggers=function(){return d},f.default=f,f},o.exports?o.exports=t():n.log=t()}(n={exports:{}},n.exports),n.exports);const{debug:i}=r.getLogger("grpc-transport");var l;!function(e){e[e.FINISH_SEND=1]="FINISH_SEND"}(l||(l={}));const c=new Uint8Array([1]);function s(e){let o="";return e.forEach(((e,n)=>{o+=`${e}: ${n.join(", ")}\r\n`})),function(e){const o=new Uint8Array(e.length);for(let r=0;r!==e.length;++r){const i=e.charCodeAt(r);if(t=void 0,!(9===(t=n=i)||10===t||13===t||n>=32&&n<=126))throw new Error("Metadata contains invalid ASCII");o[r]=i}var n,t;return o}(o)}function u(e){e.debug&&i("websocketRequest",e);const o=function(e){if("https://"===e.substr(0,8))return`wss://${e.substr(8)}`;if("http://"===e.substr(0,7))return`ws://${e.substr(7)}`;throw new Error("Websocket transport constructed with non-https:// or http:// host.")}(e.url),n=[];let r;function u(e){if(e===l.FINISH_SEND)r.send(c);else{const o=e,n=new Int8Array(o.byteLength+1);n.set(new Uint8Array([0])),n.set(o,1),r.send(n)}}return{sendMessage:e=>{r&&r.readyState!==r.CONNECTING?u(e):n.push(e)},finishSend:()=>{r&&r.readyState!==r.CONNECTING?u(l.FINISH_SEND):n.push(l.FINISH_SEND)},start:l=>{r=new t(o,["grpc-websockets"]),r.binaryType="arraybuffer",r.onopen=function(){e.debug&&i("websocketRequest.onopen"),r.send(s(l)),n.forEach((e=>{u(e)}))},r.onclose=function(o){e.debug&&i("websocketRequest.onclose",o),e.onEnd()},r.onerror=function(o){e.debug&&i("websocketRequest.onerror",o)},r.onmessage=function(o){e.onChunk(new Uint8Array(o.data))}},cancel:()=>{e.debug&&i("websocket.abort"),r.close()}}}function a(){return e=>u(e)}export{a as WebsocketTransport};
