{"version":3,"file":"index.esm.js","sources":["../../../dist/loaders/git/src/load-git.js","../../../dist/loaders/git/src/parse.js","../../../dist/loaders/git/src/index.js"],"sourcesContent":["import { execFile, execFileSync } from 'child_process';\nconst createLoadError = (error) => new Error('Unable to load file from git: ' + error);\nconst createCommand = ({ ref, path }) => {\n    return ['show', `${ref}:${path}`];\n};\n/**\n * @internal\n */\nexport async function loadFromGit(input) {\n    try {\n        return await new Promise((resolve, reject) => {\n            execFile('git', createCommand(input), { encoding: 'utf-8', maxBuffer: 1024 * 1024 * 1024 }, (error, stdout) => {\n                if (error) {\n                    reject(error);\n                }\n                else {\n                    resolve(stdout);\n                }\n            });\n        });\n    }\n    catch (error) {\n        throw createLoadError(error);\n    }\n}\n/**\n * @internal\n */\nexport function loadFromGitSync(input) {\n    try {\n        return execFileSync('git', createCommand(input), { encoding: 'utf-8' });\n    }\n    catch (error) {\n        throw createLoadError(error);\n    }\n}\n//# sourceMappingURL=load-git.js.map","import { parseGraphQLSDL, parseGraphQLJSON } from '@graphql-tools/utils';\n/**\n * @internal\n */\nexport function parse({ path, pointer, content, options, }) {\n    if (/\\.(gql|graphql)s?$/i.test(path)) {\n        return parseGraphQLSDL(pointer, content, options);\n    }\n    if (/\\.json$/i.test(path)) {\n        return parseGraphQLJSON(pointer, content, options);\n    }\n}\n//# sourceMappingURL=parse.js.map","import { gqlPluckFromCodeString, gqlPluckFromCodeStringSync, } from '@graphql-tools/graphql-tag-pluck';\nimport { loadFromGit, loadFromGitSync } from './load-git';\nimport { parse } from './parse';\n// git:branch:path/to/file\nfunction extractData(pointer) {\n    const parts = pointer.replace(/^git\\:/i, '').split(':');\n    if (!parts || parts.length !== 2) {\n        throw new Error('Schema pointer should match \"git:branchName:path/to/file\"');\n    }\n    return {\n        ref: parts[0],\n        path: parts[1],\n    };\n}\n/**\n * This loader loads a file from git.\n *\n * ```js\n * const typeDefs = await loadTypedefs('git:someBranch:some/path/to/file.js', {\n *   loaders: [new GitLoader()],\n * })\n * ```\n */\nexport class GitLoader {\n    loaderId() {\n        return 'git-loader';\n    }\n    async canLoad(pointer) {\n        return this.canLoadSync(pointer);\n    }\n    canLoadSync(pointer) {\n        return typeof pointer === 'string' && pointer.toLowerCase().startsWith('git:');\n    }\n    async load(pointer, options) {\n        const { ref, path } = extractData(pointer);\n        const content = await loadFromGit({ ref, path });\n        const parsed = parse({ path, options, pointer, content });\n        if (parsed) {\n            return parsed;\n        }\n        const rawSDL = await gqlPluckFromCodeString(pointer, content, options.pluckConfig);\n        return {\n            location: pointer,\n            rawSDL,\n        };\n    }\n    loadSync(pointer, options) {\n        const { ref, path } = extractData(pointer);\n        const content = loadFromGitSync({ ref, path });\n        const parsed = parse({ path, options, pointer, content });\n        if (parsed) {\n            return parsed;\n        }\n        const rawSDL = gqlPluckFromCodeStringSync(pointer, content, options.pluckConfig);\n        return {\n            location: pointer,\n            rawSDL,\n        };\n    }\n}\n//# sourceMappingURL=index.js.map"],"names":[],"mappings":"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"}