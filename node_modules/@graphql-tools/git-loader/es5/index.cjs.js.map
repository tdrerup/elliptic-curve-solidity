{"version":3,"file":"index.cjs.js","sources":["../../../dist-es5/loaders/git/src/load-git.js","../../../dist-es5/loaders/git/src/parse.js","../../../dist-es5/loaders/git/src/index.js"],"sourcesContent":["import { __awaiter, __generator } from \"tslib\";\nimport { execFile, execFileSync } from 'child_process';\nvar createLoadError = function (error) { return new Error('Unable to load file from git: ' + error); };\nvar createCommand = function (_a) {\n    var ref = _a.ref, path = _a.path;\n    return ['show', ref + \":\" + path];\n};\n/**\n * @internal\n */\nexport function loadFromGit(input) {\n    return __awaiter(this, void 0, void 0, function () {\n        var error_1;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    _a.trys.push([0, 2, , 3]);\n                    return [4 /*yield*/, new Promise(function (resolve, reject) {\n                            execFile('git', createCommand(input), { encoding: 'utf-8', maxBuffer: 1024 * 1024 * 1024 }, function (error, stdout) {\n                                if (error) {\n                                    reject(error);\n                                }\n                                else {\n                                    resolve(stdout);\n                                }\n                            });\n                        })];\n                case 1: return [2 /*return*/, _a.sent()];\n                case 2:\n                    error_1 = _a.sent();\n                    throw createLoadError(error_1);\n                case 3: return [2 /*return*/];\n            }\n        });\n    });\n}\n/**\n * @internal\n */\nexport function loadFromGitSync(input) {\n    try {\n        return execFileSync('git', createCommand(input), { encoding: 'utf-8' });\n    }\n    catch (error) {\n        throw createLoadError(error);\n    }\n}\n//# sourceMappingURL=load-git.js.map","import { parseGraphQLSDL, parseGraphQLJSON } from '@graphql-tools/utils';\n/**\n * @internal\n */\nexport function parse(_a) {\n    var path = _a.path, pointer = _a.pointer, content = _a.content, options = _a.options;\n    if (/\\.(gql|graphql)s?$/i.test(path)) {\n        return parseGraphQLSDL(pointer, content, options);\n    }\n    if (/\\.json$/i.test(path)) {\n        return parseGraphQLJSON(pointer, content, options);\n    }\n}\n//# sourceMappingURL=parse.js.map","import { __awaiter, __generator } from \"tslib\";\nimport { gqlPluckFromCodeString, gqlPluckFromCodeStringSync, } from '@graphql-tools/graphql-tag-pluck';\nimport { loadFromGit, loadFromGitSync } from './load-git';\nimport { parse } from './parse';\n// git:branch:path/to/file\nfunction extractData(pointer) {\n    var parts = pointer.replace(/^git\\:/i, '').split(':');\n    if (!parts || parts.length !== 2) {\n        throw new Error('Schema pointer should match \"git:branchName:path/to/file\"');\n    }\n    return {\n        ref: parts[0],\n        path: parts[1],\n    };\n}\n/**\n * This loader loads a file from git.\n *\n * ```js\n * const typeDefs = await loadTypedefs('git:someBranch:some/path/to/file.js', {\n *   loaders: [new GitLoader()],\n * })\n * ```\n */\nvar GitLoader = /** @class */ (function () {\n    function GitLoader() {\n    }\n    GitLoader.prototype.loaderId = function () {\n        return 'git-loader';\n    };\n    GitLoader.prototype.canLoad = function (pointer) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2 /*return*/, this.canLoadSync(pointer)];\n            });\n        });\n    };\n    GitLoader.prototype.canLoadSync = function (pointer) {\n        return typeof pointer === 'string' && pointer.toLowerCase().startsWith('git:');\n    };\n    GitLoader.prototype.load = function (pointer, options) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, ref, path, content, parsed, rawSDL;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        _a = extractData(pointer), ref = _a.ref, path = _a.path;\n                        return [4 /*yield*/, loadFromGit({ ref: ref, path: path })];\n                    case 1:\n                        content = _b.sent();\n                        parsed = parse({ path: path, options: options, pointer: pointer, content: content });\n                        if (parsed) {\n                            return [2 /*return*/, parsed];\n                        }\n                        return [4 /*yield*/, gqlPluckFromCodeString(pointer, content, options.pluckConfig)];\n                    case 2:\n                        rawSDL = _b.sent();\n                        return [2 /*return*/, {\n                                location: pointer,\n                                rawSDL: rawSDL,\n                            }];\n                }\n            });\n        });\n    };\n    GitLoader.prototype.loadSync = function (pointer, options) {\n        var _a = extractData(pointer), ref = _a.ref, path = _a.path;\n        var content = loadFromGitSync({ ref: ref, path: path });\n        var parsed = parse({ path: path, options: options, pointer: pointer, content: content });\n        if (parsed) {\n            return parsed;\n        }\n        var rawSDL = gqlPluckFromCodeStringSync(pointer, content, options.pluckConfig);\n        return {\n            location: pointer,\n            rawSDL: rawSDL,\n        };\n    };\n    return GitLoader;\n}());\nexport { GitLoader };\n//# sourceMappingURL=index.js.map"],"names":["__awaiter","__generator","execFile","execFileSync","parseGraphQLSDL","parseGraphQLJSON","gqlPluckFromCodeString","gqlPluckFromCodeStringSync"],"mappings":"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"}