{"version":3,"file":"index.cjs.js","sources":["../../../dist-es5/batch-delegate/src/getLoader.js","../../../dist-es5/batch-delegate/src/batchDelegateToSchema.js","../../../dist-es5/batch-delegate/src/createBatchDelegateFn.js"],"sourcesContent":["import { __assign, __awaiter, __generator } from \"tslib\";\nimport { getNamedType, GraphQLList } from 'graphql';\nimport DataLoader from 'dataloader';\nimport { delegateToSchema } from '@graphql-tools/delegate';\nvar cache1 = new WeakMap();\nfunction createBatchFn(options) {\n    var _this = this;\n    var _a;\n    var argsFromKeys = (_a = options.argsFromKeys) !== null && _a !== void 0 ? _a : (function (keys) { return ({ ids: keys }); });\n    var valuesFromResults = options.valuesFromResults, lazyOptionsFn = options.lazyOptionsFn;\n    return function (keys) { return __awaiter(_this, void 0, void 0, function () {\n        var results, values;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0: return [4 /*yield*/, delegateToSchema(__assign({ returnType: new GraphQLList(getNamedType(options.info.returnType)), args: argsFromKeys(keys) }, (lazyOptionsFn == null ? options : lazyOptionsFn(options))))];\n                case 1:\n                    results = _a.sent();\n                    values = valuesFromResults == null ? results : valuesFromResults(results, keys);\n                    return [2 /*return*/, Array.isArray(values) ? values : keys.map(function () { return values; })];\n            }\n        });\n    }); };\n}\nexport function getLoader(options) {\n    var cache2 = cache1.get(options.info.fieldNodes);\n    var loader;\n    if (cache2 === undefined) {\n        var batchFn_1 = createBatchFn(options);\n        cache2 = new WeakMap();\n        cache1.set(options.info.fieldNodes, cache2);\n        loader = new DataLoader(function (keys) { return batchFn_1(keys); }, options.dataLoaderOptions);\n        cache2.set(options.schema, loader);\n        return loader;\n    }\n    loader = cache2.get(options.schema);\n    if (loader === undefined) {\n        var batchFn_2 = createBatchFn(options);\n        loader = new DataLoader(function (keys) { return batchFn_2(keys); }, options.dataLoaderOptions);\n        cache2.set(options.schema, loader);\n        return loader;\n    }\n    return loader;\n}\n//# sourceMappingURL=getLoader.js.map","import { getLoader } from './getLoader';\nexport function batchDelegateToSchema(options) {\n    var key = options.key;\n    if (key == null) {\n        return null;\n    }\n    else if (Array.isArray(key) && !key.length) {\n        return [];\n    }\n    var loader = getLoader(options);\n    return Array.isArray(key) ? loader.loadMany(key) : loader.load(key);\n}\n//# sourceMappingURL=batchDelegateToSchema.js.map","import { __assign } from \"tslib\";\nimport { getLoader } from './getLoader';\nexport function createBatchDelegateFn(optionsOrArgsFromKeys, lazyOptionsFn, dataLoaderOptions, valuesFromResults) {\n    return typeof optionsOrArgsFromKeys === 'function'\n        ? createBatchDelegateFnImpl({\n            argsFromKeys: optionsOrArgsFromKeys,\n            lazyOptionsFn: lazyOptionsFn,\n            dataLoaderOptions: dataLoaderOptions,\n            valuesFromResults: valuesFromResults,\n        })\n        : createBatchDelegateFnImpl(optionsOrArgsFromKeys);\n}\nfunction createBatchDelegateFnImpl(options) {\n    return function (batchDelegateOptions) {\n        var loader = getLoader(__assign(__assign({}, options), batchDelegateOptions));\n        return loader.load(batchDelegateOptions.key);\n    };\n}\n//# sourceMappingURL=createBatchDelegateFn.js.map"],"names":["__awaiter","__generator","delegateToSchema","__assign","GraphQLList","getNamedType"],"mappings":";;;;;;;;;;;AAIA,IAAI,MAAM,GAAG,IAAI,OAAO,EAAE,CAAC;AAC3B,SAAS,aAAa,CAAC,OAAO,EAAE;AAChC,IAAI,IAAI,KAAK,GAAG,IAAI,CAAC;AACrB,IAAI,IAAI,EAAE,CAAC;AACX,IAAI,IAAI,YAAY,GAAG,CAAC,EAAE,GAAG,OAAO,CAAC,YAAY,MAAM,IAAI,IAAI,EAAE,KAAK,KAAK,CAAC,GAAG,EAAE,IAAI,UAAU,IAAI,EAAE,EAAE,QAAQ,EAAE,GAAG,EAAE,IAAI,EAAE,EAAE,EAAE,CAAC,CAAC;AAClI,IAAI,IAAI,iBAAiB,GAAG,OAAO,CAAC,iBAAiB,EAAE,aAAa,GAAG,OAAO,CAAC,aAAa,CAAC;AAC7F,IAAI,OAAO,UAAU,IAAI,EAAE,EAAE,OAAOA,eAAS,CAAC,KAAK,EAAE,KAAK,CAAC,EAAE,KAAK,CAAC,EAAE,YAAY;AACjF,QAAQ,IAAI,OAAO,EAAE,MAAM,CAAC;AAC5B,QAAQ,OAAOC,iBAAW,CAAC,IAAI,EAAE,UAAU,EAAE,EAAE;AAC/C,YAAY,QAAQ,EAAE,CAAC,KAAK;AAC5B,gBAAgB,KAAK,CAAC,EAAE,OAAO,CAAC,CAAC,YAAYC,yBAAgB,CAACC,cAAQ,CAAC,EAAE,UAAU,EAAE,IAAIC,mBAAW,CAACC,oBAAY,CAAC,OAAO,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,EAAE,IAAI,EAAE,YAAY,CAAC,IAAI,CAAC,EAAE,GAAG,aAAa,IAAI,IAAI,GAAG,OAAO,GAAG,aAAa,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC,CAAC;AACvO,gBAAgB,KAAK,CAAC;AACtB,oBAAoB,OAAO,GAAG,EAAE,CAAC,IAAI,EAAE,CAAC;AACxC,oBAAoB,MAAM,GAAG,iBAAiB,IAAI,IAAI,GAAG,OAAO,GAAG,iBAAiB,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC;AACpG,oBAAoB,OAAO,CAAC,CAAC,aAAa,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,GAAG,MAAM,GAAG,IAAI,CAAC,GAAG,CAAC,YAAY,EAAE,OAAO,MAAM,CAAC,EAAE,CAAC,CAAC,CAAC;AACrH,aAAa;AACb,SAAS,CAAC,CAAC;AACX,KAAK,CAAC,CAAC,EAAE,CAAC;AACV,CAAC;AACM,SAAS,SAAS,CAAC,OAAO,EAAE;AACnC,IAAI,IAAI,MAAM,GAAG,MAAM,CAAC,GAAG,CAAC,OAAO,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;AACrD,IAAI,IAAI,MAAM,CAAC;AACf,IAAI,IAAI,MAAM,KAAK,SAAS,EAAE;AAC9B,QAAQ,IAAI,SAAS,GAAG,aAAa,CAAC,OAAO,CAAC,CAAC;AAC/C,QAAQ,MAAM,GAAG,IAAI,OAAO,EAAE,CAAC;AAC/B,QAAQ,MAAM,CAAC,GAAG,CAAC,OAAO,CAAC,IAAI,CAAC,UAAU,EAAE,MAAM,CAAC,CAAC;AACpD,QAAQ,MAAM,GAAG,IAAI,UAAU,CAAC,UAAU,IAAI,EAAE,EAAE,OAAO,SAAS,CAAC,IAAI,CAAC,CAAC,EAAE,EAAE,OAAO,CAAC,iBAAiB,CAAC,CAAC;AACxG,QAAQ,MAAM,CAAC,GAAG,CAAC,OAAO,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC;AAC3C,QAAQ,OAAO,MAAM,CAAC;AACtB,KAAK;AACL,IAAI,MAAM,GAAG,MAAM,CAAC,GAAG,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;AACxC,IAAI,IAAI,MAAM,KAAK,SAAS,EAAE;AAC9B,QAAQ,IAAI,SAAS,GAAG,aAAa,CAAC,OAAO,CAAC,CAAC;AAC/C,QAAQ,MAAM,GAAG,IAAI,UAAU,CAAC,UAAU,IAAI,EAAE,EAAE,OAAO,SAAS,CAAC,IAAI,CAAC,CAAC,EAAE,EAAE,OAAO,CAAC,iBAAiB,CAAC,CAAC;AACxG,QAAQ,MAAM,CAAC,GAAG,CAAC,OAAO,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC;AAC3C,QAAQ,OAAO,MAAM,CAAC;AACtB,KAAK;AACL,IAAI,OAAO,MAAM,CAAC;AAClB;;ACzCO,SAAS,qBAAqB,CAAC,OAAO,EAAE;AAC/C,IAAI,IAAI,GAAG,GAAG,OAAO,CAAC,GAAG,CAAC;AAC1B,IAAI,IAAI,GAAG,IAAI,IAAI,EAAE;AACrB,QAAQ,OAAO,IAAI,CAAC;AACpB,KAAK;AACL,SAAS,IAAI,KAAK,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,MAAM,EAAE;AAChD,QAAQ,OAAO,EAAE,CAAC;AAClB,KAAK;AACL,IAAI,IAAI,MAAM,GAAG,SAAS,CAAC,OAAO,CAAC,CAAC;AACpC,IAAI,OAAO,KAAK,CAAC,OAAO,CAAC,GAAG,CAAC,GAAG,MAAM,CAAC,QAAQ,CAAC,GAAG,CAAC,GAAG,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;AACxE;;ACTO,SAAS,qBAAqB,CAAC,qBAAqB,EAAE,aAAa,EAAE,iBAAiB,EAAE,iBAAiB,EAAE;AAClH,IAAI,OAAO,OAAO,qBAAqB,KAAK,UAAU;AACtD,UAAU,yBAAyB,CAAC;AACpC,YAAY,YAAY,EAAE,qBAAqB;AAC/C,YAAY,aAAa,EAAE,aAAa;AACxC,YAAY,iBAAiB,EAAE,iBAAiB;AAChD,YAAY,iBAAiB,EAAE,iBAAiB;AAChD,SAAS,CAAC;AACV,UAAU,yBAAyB,CAAC,qBAAqB,CAAC,CAAC;AAC3D,CAAC;AACD,SAAS,yBAAyB,CAAC,OAAO,EAAE;AAC5C,IAAI,OAAO,UAAU,oBAAoB,EAAE;AAC3C,QAAQ,IAAI,MAAM,GAAG,SAAS,CAACF,cAAQ,CAACA,cAAQ,CAAC,EAAE,EAAE,OAAO,CAAC,EAAE,oBAAoB,CAAC,CAAC,CAAC;AACtF,QAAQ,OAAO,MAAM,CAAC,IAAI,CAAC,oBAAoB,CAAC,GAAG,CAAC,CAAC;AACrD,KAAK,CAAC;AACN;;;;;"}