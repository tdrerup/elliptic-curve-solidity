{"version":3,"file":"index.esm.js","sources":["../../../dist/batch-delegate/src/getLoader.js","../../../dist/batch-delegate/src/batchDelegateToSchema.js","../../../dist/batch-delegate/src/createBatchDelegateFn.js"],"sourcesContent":["import { getNamedType, GraphQLList } from 'graphql';\nimport DataLoader from 'dataloader';\nimport { delegateToSchema } from '@graphql-tools/delegate';\nconst cache1 = new WeakMap();\nfunction createBatchFn(options) {\n    var _a;\n    const argsFromKeys = (_a = options.argsFromKeys) !== null && _a !== void 0 ? _a : ((keys) => ({ ids: keys }));\n    const { valuesFromResults, lazyOptionsFn } = options;\n    return async (keys) => {\n        const results = await delegateToSchema({\n            returnType: new GraphQLList(getNamedType(options.info.returnType)),\n            args: argsFromKeys(keys),\n            ...(lazyOptionsFn == null ? options : lazyOptionsFn(options)),\n        });\n        const values = valuesFromResults == null ? results : valuesFromResults(results, keys);\n        return Array.isArray(values) ? values : keys.map(() => values);\n    };\n}\nexport function getLoader(options) {\n    let cache2 = cache1.get(options.info.fieldNodes);\n    let loader;\n    if (cache2 === undefined) {\n        const batchFn = createBatchFn(options);\n        cache2 = new WeakMap();\n        cache1.set(options.info.fieldNodes, cache2);\n        loader = new DataLoader(keys => batchFn(keys), options.dataLoaderOptions);\n        cache2.set(options.schema, loader);\n        return loader;\n    }\n    loader = cache2.get(options.schema);\n    if (loader === undefined) {\n        const batchFn = createBatchFn(options);\n        loader = new DataLoader(keys => batchFn(keys), options.dataLoaderOptions);\n        cache2.set(options.schema, loader);\n        return loader;\n    }\n    return loader;\n}\n//# sourceMappingURL=getLoader.js.map","import { getLoader } from './getLoader';\nexport function batchDelegateToSchema(options) {\n    const key = options.key;\n    if (key == null) {\n        return null;\n    }\n    else if (Array.isArray(key) && !key.length) {\n        return [];\n    }\n    const loader = getLoader(options);\n    return Array.isArray(key) ? loader.loadMany(key) : loader.load(key);\n}\n//# sourceMappingURL=batchDelegateToSchema.js.map","import { getLoader } from './getLoader';\nexport function createBatchDelegateFn(optionsOrArgsFromKeys, lazyOptionsFn, dataLoaderOptions, valuesFromResults) {\n    return typeof optionsOrArgsFromKeys === 'function'\n        ? createBatchDelegateFnImpl({\n            argsFromKeys: optionsOrArgsFromKeys,\n            lazyOptionsFn,\n            dataLoaderOptions,\n            valuesFromResults,\n        })\n        : createBatchDelegateFnImpl(optionsOrArgsFromKeys);\n}\nfunction createBatchDelegateFnImpl(options) {\n    return batchDelegateOptions => {\n        const loader = getLoader({\n            ...options,\n            ...batchDelegateOptions,\n        });\n        return loader.load(batchDelegateOptions.key);\n    };\n}\n//# sourceMappingURL=createBatchDelegateFn.js.map"],"names":[],"mappings":"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"}