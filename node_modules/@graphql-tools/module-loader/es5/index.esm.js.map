{"version":3,"file":"index.esm.js","sources":["../../../dist-es5/loaders/module/src/index.js"],"sourcesContent":["import { __awaiter, __generator } from \"tslib\";\nimport { parse, isSchema } from 'graphql';\nimport { fixSchemaAst, getDocumentNodeFromSchema, } from '@graphql-tools/utils';\nvar InvalidError = new Error(\"Imported object was not a string, DocumentNode or GraphQLSchema\");\nvar createLoadError = function (error) {\n    return new Error('Unable to load schema from module: ' + (\"\" + (error.message || /* istanbul ignore next */ error)));\n};\n// module:node/module#export\nfunction extractData(pointer) {\n    var parts = pointer.replace(/^module\\:/i, '').split('#');\n    if (!parts || parts.length > 2) {\n        throw new Error('Schema pointer should match \"module:path/to/module#export\"');\n    }\n    return {\n        modulePath: parts[0],\n        exportName: parts[1],\n    };\n}\n/**\n * * This loader loads documents and type definitions from a Node module\n *\n * ```js\n * const schema = await loadSchema('module:someModuleName#someNamedExport', {\n *   loaders: [new ModuleLoader()],\n * })\n * ```\n */\nvar ModuleLoader = /** @class */ (function () {\n    function ModuleLoader() {\n    }\n    ModuleLoader.prototype.loaderId = function () {\n        return 'module-loader';\n    };\n    ModuleLoader.prototype.canLoad = function (pointer) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2 /*return*/, this.canLoadSync(pointer)];\n            });\n        });\n    };\n    ModuleLoader.prototype.canLoadSync = function (pointer) {\n        return typeof pointer === 'string' && pointer.toLowerCase().startsWith('module:');\n    };\n    ModuleLoader.prototype.load = function (pointer, options) {\n        return __awaiter(this, void 0, void 0, function () {\n            var result, _a, _b, error_1;\n            return __generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0:\n                        _c.trys.push([0, 2, , 3]);\n                        _a = this.parse;\n                        _b = [pointer, options];\n                        return [4 /*yield*/, this.importModule(pointer)];\n                    case 1:\n                        result = _a.apply(this, _b.concat([_c.sent()]));\n                        if (result) {\n                            return [2 /*return*/, result];\n                        }\n                        throw InvalidError;\n                    case 2:\n                        error_1 = _c.sent();\n                        throw createLoadError(error_1);\n                    case 3: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    ModuleLoader.prototype.loadSync = function (pointer, options) {\n        try {\n            var result = this.parse(pointer, options, this.importModuleSync(pointer));\n            if (result) {\n                return result;\n            }\n            throw InvalidError;\n        }\n        catch (error) {\n            throw createLoadError(error);\n        }\n    };\n    ModuleLoader.prototype.parse = function (pointer, options, importedModule) {\n        if (isSchema(importedModule)) {\n            var schema_1 = fixSchemaAst(importedModule, options);\n            return {\n                schema: schema_1,\n                get document() {\n                    return getDocumentNodeFromSchema(schema_1);\n                },\n                location: pointer,\n            };\n        }\n        else if (typeof importedModule === 'string') {\n            return {\n                location: pointer,\n                document: parse(importedModule),\n            };\n        }\n        else if (typeof importedModule === 'object' && importedModule.kind === 'Document') {\n            return {\n                location: pointer,\n                document: importedModule,\n            };\n        }\n    };\n    ModuleLoader.prototype.extractFromModule = function (mod, modulePath, identifier) {\n        var thing = identifier ? mod[identifier] : mod;\n        if (!thing) {\n            throw new Error('Unable to import an object from module: ' + modulePath);\n        }\n        return thing;\n    };\n    // Sync and Async\n    ModuleLoader.prototype.importModule = function (pointer) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, modulePath, exportName, imported;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        _a = extractData(pointer), modulePath = _a.modulePath, exportName = _a.exportName;\n                        return [4 /*yield*/, import(modulePath)];\n                    case 1:\n                        imported = _b.sent();\n                        return [2 /*return*/, this.extractFromModule(imported, modulePath, exportName || 'default')];\n                }\n            });\n        });\n    };\n    ModuleLoader.prototype.importModuleSync = function (pointer) {\n        var _a = extractData(pointer), modulePath = _a.modulePath, exportName = _a.exportName;\n        var imported = require(modulePath);\n        return this.extractFromModule(imported, modulePath, exportName);\n    };\n    return ModuleLoader;\n}());\nexport { ModuleLoader };\n//# sourceMappingURL=index.js.map"],"names":[],"mappings":"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"}